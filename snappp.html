<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MySnapApp â€” Snap & Location</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
    }

    h3 {
      margin-top: 0;
    }

    .card {
      background: #fff;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }

    video,
    canvas,
    img {
      width: 100%;
      border-radius: 8px;
    }

    input,
    button {
      padding: 10px;
      margin-top: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .btn {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    .btn.secondary {
      background: #e9f2ff;
      color: #007bff;
    }

    #map {
      width: 100%;
      height: 300px;
      margin-top: 10px;
      border-radius: 8px;
    }
  </style>
</head>

<body>
  <h2>ðŸ“¸ MySnapApp</h2>

  <!-- Camera Section -->
  <div class="card">
    <h3>Snap</h3>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
    <img id="photoPreview" alt="snapshot preview" />
    <button id="startCam" class="btn">Start Camera</button>
    <button id="snapBtn" class="btn secondary" disabled>Take Snapshot</button>
    <a id="downloadLink" style="display:none;" class="btn">Download Photo</a>
  </div>

  <!-- Location Section -->
  <div class="card">
    <h3>Location</h3>
    <label><input type="checkbox" id="locationToggle"> Turn on location</label>
    <div id="locStatus">Location is off</div>

    <input id="autocomplete" placeholder="Enter address manually" />
    <input id="address" placeholder="Street Address" />
    <input id="city" placeholder="City" />
    <input id="state" placeholder="State" />
    <input id="lat" placeholder="Latitude" readonly />
    <input id="lon" placeholder="Longitude" readonly />

    <!-- Google Map -->
    <div id="map"></div>
  </div>

  <script>
    // --- Camera ---
    const startCamBtn = document.getElementById('startCam');
    const snapBtn = document.getElementById('snapBtn');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const photoPreview = document.getElementById('photoPreview');
    const downloadLink = document.getElementById('downloadLink');
    let stream = null;

    startCamBtn.onclick = async () => {
      if (stream) { stream.getTracks().forEach(t => t.stop()); video.srcObject = null; stream = null; startCamBtn.textContent = "Start Camera"; snapBtn.disabled = true; return; }
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        startCamBtn.textContent = "Stop Camera";
        snapBtn.disabled = false;
      } catch (e) { alert("Camera error: " + e.message); }
    };
    snapBtn.onclick = () => {
      const w = video.videoWidth, h = video.videoHeight;
      canvas.width = w; canvas.height = h;
      canvas.getContext("2d").drawImage(video, 0, 0, w, h);
      const dataUrl = canvas.toDataURL("image/jpeg");
      photoPreview.src = dataUrl;
      downloadLink.href = dataUrl; downloadLink.download = "snap.jpg"; downloadLink.style.display = "block";
    };

    // --- Location ---
    const locToggle = document.getElementById('locationToggle');
    const locStatus = document.getElementById('locStatus');
    const latInput = document.getElementById('lat');
    const lonInput = document.getElementById('lon');
    const addrInput = document.getElementById('address');
    const cityInput = document.getElementById('city');
    const stateInput = document.getElementById('state');
    let map, marker;

    locToggle.onchange = () => {
      if (locToggle.checked) {
        if (navigator.geolocation) {
          locStatus.textContent = "Fetching location...";
          navigator.geolocation.getCurrentPosition(async (pos) => {
            const lat = pos.coords.latitude, lon = pos.coords.longitude;
            latInput.value = lat; lonInput.value = lon;
            locStatus.textContent = "Location fetched!";
            setMap(lat, lon);
            await geocodeLatLng(lat, lon);
          }, (err) => { locStatus.textContent = "Error: " + err.message; locToggle.checked = false; });
        }
      } else { locStatus.textContent = "Location is off"; latInput.value = ""; lonInput.value = ""; }
    };

    // --- Google Maps API ---
    let autocomplete;
    function initAutocomplete() {
      autocomplete = new google.maps.places.Autocomplete(document.getElementById("autocomplete"), { types: ["geocode"] });
      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry) return;
        const lat = place.geometry.location.lat(), lon = place.geometry.location.lng();
        latInput.value = lat; lonInput.value = lon;
        fillAddressFields(place);
        setMap(lat, lon);
      });
      // initialize default map
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 20.5937, lng: 78.9629 }, // India center
        zoom: 5
      });
    }

    function fillAddressFields(place) {
      let addr = "", city = "", state = "";
      if (place.address_components) {
        place.address_components.forEach(c => {
          if (c.types.includes("street_number") || c.types.includes("route")) addr += (c.long_name + " ");
          if (c.types.includes("locality")) city = c.long_name;
          if (c.types.includes("administrative_area_level_1")) state = c.long_name;
        });
      }
      addrInput.value = addr.trim();
      cityInput.value = city;
      stateInput.value = state;
    }

    async function geocodeLatLng(lat, lon) {
      const resp = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lon}&key=YOUR_API_KEY_HERE`);
      const data = await resp.json();
      if (data.results && data.results[0]) {
        fillAddressFields(data.results[0]);
      }
    }

    function setMap(lat, lon) {
      if (!map) return;
      map.setCenter({ lat: lat, lng: lon });
      map.setZoom(15);
      if (marker) marker.setMap(null);
      marker = new google.maps.Marker({ position: { lat: lat, lng: lon }, map: map });
    }
  </script>

  <!-- Google Maps API Script -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=places&callback=initAutocomplete"
    async defer></script>
</body>

</html>