<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Snap & Location</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f6fa;
      color: #333;
    }

    header {
      background: #0066cc;
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }

    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }

    h2 {
      margin-bottom: 15px;
      color: #0066cc;
      font-size: 1.3rem;
    }

    video,
    canvas,
    img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    input,
    button {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    button {
      background: #0066cc;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #004c99;
    }

    #map {
      width: 100%;
      height: 350px;
      border-radius: 10px;
      margin-top: 15px;
    }

    #output {
      background: #f9f9f9;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 10px;
      font-size: 0.9rem;
      white-space: pre-wrap;
      margin-top: 15px;
    }
  </style>
</head>

<body>
  <header>ðŸ“¸ Project Snap & Location</header>
  <main>
    <!-- Camera -->
    <div class="card">
      <h2>Take a Snap</h2>
      <video id="video" autoplay playsinline></video>
      <canvas id="canvas" style="display:none;"></canvas>
      <img id="photoPreview" alt="Snapshot Preview" />
      <button id="startCam">Start Camera</button>
      <button id="snapBtn" disabled>Take Snapshot</button>
    </div>

    <!-- Location -->
    <div class="card">
      <h2>Add Location</h2>
      <input id="autocomplete" placeholder="Enter location manually..." />
      <input id="address" placeholder="Street Address" readonly />
      <input id="city" placeholder="City" readonly />
      <input id="state" placeholder="State" readonly />
      <input id="lat" placeholder="Latitude" readonly />
      <input id="lon" placeholder="Longitude" readonly />
      <div id="map"></div>
    </div>

    <!-- Submit -->
    <div class="card">
      <h2>Submit</h2>
      <button id="submitBtn">Submit Info</button>
      <div id="output"></div>
    </div>
  </main>

  <script>
    // --- Camera ---
    const startCamBtn = document.getElementById("startCam");
    const snapBtn = document.getElementById("snapBtn");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const photoPreview = document.getElementById("photoPreview");
    let stream = null;

    startCamBtn.onclick = async () => {
      if (stream) {
        stream.getTracks().forEach((t) => t.stop());
        video.srcObject = null;
        stream = null;
        startCamBtn.textContent = "Start Camera";
        snapBtn.disabled = true;
        return;
      }
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        startCamBtn.textContent = "Stop Camera";
        snapBtn.disabled = false;
      } catch (e) {
        alert("Camera error: " + e.message);
      }
    };

    snapBtn.onclick = () => {
      const w = video.videoWidth,
        h = video.videoHeight;
      canvas.width = w;
      canvas.height = h;
      canvas.getContext("2d").drawImage(video, 0, 0, w, h);
      const dataUrl = canvas.toDataURL("image/jpeg");
      photoPreview.src = dataUrl;
    };

    // --- Google Maps ---
    let map, marker, autocomplete;
    const latInput = document.getElementById("lat");
    const lonInput = document.getElementById("lon");
    const addrInput = document.getElementById("address");
    const cityInput = document.getElementById("city");
    const stateInput = document.getElementById("state");

    function initAutocomplete() {
      autocomplete = new google.maps.places.Autocomplete(
        document.getElementById("autocomplete"),
        { types: ["geocode"] }
      );

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry) return;
        const lat = place.geometry.location.lat();
        const lon = place.geometry.location.lng();
        latInput.value = lat;
        lonInput.value = lon;
        fillAddressFields(place);
        setMap(lat, lon);
      });

      // Initialize Map
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 20.5937, lng: 78.9629 }, // India center
        zoom: 5,
      });
    }

    function fillAddressFields(place) {
      let addr = "",
        city = "",
        state = "";
      if (place.address_components) {
        place.address_components.forEach((c) => {
          if (
            c.types.includes("street_number") ||
            c.types.includes("route")
          )
            addr += c.long_name + " ";
          if (c.types.includes("locality")) city = c.long_name;
          if (c.types.includes("administrative_area_level_1"))
            state = c.long_name;
        });
      }
      addrInput.value = addr.trim();
      cityInput.value = city;
      stateInput.value = state;
    }

    function setMap(lat, lon) {
      map.setCenter({ lat: lat, lng: lon });
      map.setZoom(15);
      if (marker) marker.setMap(null);
      marker = new google.maps.Marker({
        position: { lat: lat, lng: lon },
        map: map,
        draggable: true,
      });
      marker.addListener("dragend", (e) => {
        const newLat = e.latLng.lat(),
          newLon = e.latLng.lng();
        latInput.value = newLat;
        lonInput.value = newLon;
      });
    }

    // --- Submit ---
    document.getElementById("submitBtn").onclick = () => {
      const data = {
        photo: photoPreview.src || "No photo",
        address: addrInput.value,
        city: cityInput.value,
        state: stateInput.value,
        lat: latInput.value,
        lon: lonInput.value,
      };
      document.getElementById("output").textContent = JSON.stringify(
        data,
        null,
        2
      );
      alert("Information submitted!");
    };
  </script>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=places&callback=initAutocomplete"
    async defer></script>
</body>

</html>